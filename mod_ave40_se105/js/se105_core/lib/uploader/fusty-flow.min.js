!function(e,t,i,n){"use strict";function r(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i}function o(e,t,i){e.removeEventListener?e.removeEventListener(t,i,!1):e.detachEvent?e.detachEvent("on"+t,i):e["on"+t]=null}function s(e){e.parentNode.removeChild(e)}function a(e){var t={};return e&&"[object Function]"===t.toString.call(e)}function u(t){this.support=!1,this.files=[],this.events=[],this.defaults={simultaneousUploads:3,fileParameterName:"file",query:{},target:"/",generateUniqueIdentifier:null,matchJSON:!1};var i=this;this.inputChangeEvent=function(e){var t=e.target||e.srcElement;o(t,"change",i.inputChangeEvent);var n=t.cloneNode(!1);t.parentNode.replaceChild(n,t),i.addFile(t,e),n.value="",r(n,"change",i.inputChangeEvent)},this.opts=e.extend({},this.defaults,t||{})}function f(e,t){this.flowObj=e,this.element=t,this.name=t.value&&t.value.replace(/.*(\/|\\)/,""),this.relativePath=this.name,this.uniqueIdentifier=e.generateUniqueIdentifier(t),this.iFrame=null,this.finished=!1,this.error=!1,this.paused=!1;var i=this;this.iFrameLoaded=function(e){if(i.iFrame&&i.iFrame.parentNode){i.finished=!0;try{if(i.iFrame.contentDocument&&i.iFrame.contentDocument.body&&"false"==i.iFrame.contentDocument.body.innerHTML)return}catch(e){return i.error=!0,i.abort(),void i.flowObj.fire("fileError",i,e)}var t=i.iFrame.contentDocument||i.iFrame.contentWindow.document,n=t.body.innerHTML;i.flowObj.opts.matchJSON&&(n=/(\{.*\})/.exec(n)[0]),i.abort(),i.flowObj.fire("fileSuccess",i,n),i.flowObj.upload()}},this.bootstrap()}var l=e.extend,h=e.each;u.prototype={on:e.prototype.on,off:e.prototype.off,fire:e.prototype.fire,cancel:e.prototype.cancel,assignBrowse:function(e){void 0===e.length&&(e=[e]),h(e,function(e){var t;"INPUT"===e.tagName&&"file"===e.type?t=e:(t=i.createElement("input"),t.setAttribute("type","file"),l(e.style,{display:"inline-block",position:"relative",overflow:"hidden",verticalAlign:"top"}),l(t.style,{position:"absolute",top:0,right:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,opacity:0,filter:"alpha(opacity=0)",cursor:"pointer"}),e.appendChild(t)),r(t,"change",this.inputChangeEvent)},this)},assignDrop:function(){},unAssignDrop:function(){},isUploading:function(){var e=!1;return h(this.files,function(t){if(t.isUploading())return e=!0,!1}),e},upload:function(){var e=0;h(this.files,function(t){if(1!=t.progress()&&!t.isPaused()){if(t.isUploading())return void e++;if(e++>=this.opts.simultaneousUploads)return!1;1==e&&this.fire("uploadStart"),t.send()}},this),e||this.fire("complete")},pause:function(){h(this.files,function(e){e.pause()})},resume:function(){h(this.files,function(e){e.resume()})},progress:function(){var e=0,t=0;return h(this.files,function(i){e+=i.progress(),t++}),t>0?e/t:0},addFiles:function(e,t){var i=[];h(e,function(e){if(1===e.nodeType&&e.value){var n=new f(this,e);this.fire("fileAdded",n,t)&&i.push(n)}},this),this.fire("filesAdded",i,t)&&h(i,function(e){this.opts.singleFile&&this.files.length>0&&this.removeFile(this.files[0]),this.files.push(e)},this),this.fire("filesSubmitted",i,t)},addFile:function(e,t){this.addFiles([e],t)},generateUniqueIdentifier:function(e){var t=this.opts.generateUniqueIdentifier;return"function"==typeof t?t(e):"xxxxxxxx-xxxx-yxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},getFromUniqueIdentifier:function(e){var t=!1;return h(this.files,function(i){i.uniqueIdentifier==e&&(t=i)}),t},removeFile:function(e){for(var t=this.files.length-1;t>=0;t--)this.files[t]===e&&this.files.splice(t,1)},getSize:function(){},timeRemaining:function(){},sizeUploaded:function(){}},f.prototype={getExtension:e.FlowFile.prototype.getExtension,getType:function(){},send:function(){if(!this.finished){var e=this.flowObj.opts,t=this.createForm(),i=e.query;a(i)&&(i=i(this)),i[e.fileParameterName]=this.element,i.flowFilename=this.name,i.flowRelativePath=this.relativePath,i.flowIdentifier=this.uniqueIdentifier,this.addFormParams(t,i),r(this.iFrame,"load",this.iFrameLoaded),t.submit(),s(t)}},abort:function(e){this.iFrame&&(this.iFrame.setAttribute("src","java"+String.fromCharCode(115)+"cript:false;"),s(this.iFrame),this.iFrame=null,!e&&this.flowObj.upload())},cancel:function(){this.flowObj.removeFile(this),this.abort()},retry:function(){this.bootstrap(),this.flowObj.upload()},bootstrap:function(){this.abort(!0),this.finished=!1,this.error=!1},timeRemaining:function(){},sizeUploaded:function(){},resume:function(){this.paused=!1,this.flowObj.upload()},pause:function(){this.paused=!0,this.abort()},isUploading:function(){return null!==this.iFrame},isPaused:function(){return this.paused},isComplete:function(){return 1===this.progress()},progress:function(){return this.error?1:this.finished?1:0},createIframe:function(){var e=/MSIE (6|7|8)/.test(navigator.userAgent)?i.createElement('<iframe name="'+this.uniqueIdentifier+'_iframe">'):i.createElement("iframe");return e.setAttribute("id",this.uniqueIdentifier+"_iframe_id"),e.setAttribute("name",this.uniqueIdentifier+"_iframe"),e.style.display="none",i.body.appendChild(e),e},createForm:function(){var e=this.flowObj.opts.target;"function"==typeof e&&(e=e.apply(null));var t=i.createElement("form");return t.encoding="multipart/form-data",t.method="POST",t.setAttribute("action",e),this.iFrame||(this.iFrame=this.createIframe()),t.setAttribute("target",this.iFrame.name),t.style.display="none",i.body.appendChild(t),t},addFormParams:function(e,t){var n;h(t,function(t,r){t&&1===t.nodeType?n=t:(n=i.createElement("input"),n.setAttribute("value",t)),n.setAttribute("name",r),e.appendChild(n)})}},u.FustyFlowFile=f,"undefined"!=typeof module?module.exports=u:"function"==typeof define&&define.amd?define(function(){return u}):t.FustyFlow=u}(window.Flow,window,document);