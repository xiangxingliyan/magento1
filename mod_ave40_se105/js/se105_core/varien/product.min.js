if(void 0===Product)var Product={};Product.Zoom=Class.create(),Product.Zoom.prototype={initialize:function(i,t,e,s,o,n){if(this.containerEl=$(i).parentNode,this.imageEl=$(i),this.handleEl=$(e),this.trackEl=$(t),this.hintEl=$(n),this.containerDim=Element.getDimensions(this.containerEl),this.imageDim=Element.getDimensions(this.imageEl),this.imageDim.ratio=this.imageDim.width/this.imageDim.height,this.floorZoom=1,this.imageDim.width>this.imageDim.height?this.ceilingZoom=this.imageDim.width/this.containerDim.width:this.ceilingZoom=this.imageDim.height/this.containerDim.height,this.imageDim.width<=this.containerDim.width&&this.imageDim.height<=this.containerDim.height)return this.trackEl.up().hide(),this.hintEl.hide(),void this.containerEl.removeClassName("product-image-zoom");this.imageX=0,this.imageY=0,this.imageZoom=1,this.sliderSpeed=0,this.sliderAccel=0,this.zoomBtnPressed=!1,this.showFull=!1,this.selects=document.getElementsByTagName("select"),this.draggable=new Draggable(i,{starteffect:!1,reverteffect:!1,endeffect:!1,snap:this.contain.bind(this)}),this.slider=new Control.Slider(e,t,{axis:"horizontal",minimum:0,maximum:Element.getDimensions(this.trackEl).width,alignX:0,increment:1,sliderValue:0,onSlide:this.scale.bind(this),onChange:this.scale.bind(this)}),this.scale(0),Event.observe(this.imageEl,"dblclick",this.toggleFull.bind(this)),Event.observe($(s),"mousedown",this.startZoomIn.bind(this)),Event.observe($(s),"mouseup",this.stopZooming.bind(this)),Event.observe($(s),"mouseout",this.stopZooming.bind(this)),Event.observe($(o),"mousedown",this.startZoomOut.bind(this)),Event.observe($(o),"mouseup",this.stopZooming.bind(this)),Event.observe($(o),"mouseout",this.stopZooming.bind(this))},toggleFull:function(){if(this.showFull=!this.showFull,void 0===document.body.style.maxHeight)for(i=0;i<this.selects.length;i++)this.selects[i].style.visibility=this.showFull?"hidden":"visible";return val_scale=this.showFull?1:this.slider.value,this.scale(val_scale),this.trackEl.style.visibility=this.showFull?"hidden":"visible",this.containerEl.style.overflow=this.showFull?"visible":"hidden",this.containerEl.style.zIndex=this.showFull?"1000":"9",this},scale:function(i){var t=(this.containerDim.width*(1-this.imageZoom)/2-this.imageX)/this.imageZoom,e=(this.containerDim.height*(1-this.imageZoom)/2-this.imageY)/this.imageZoom,s=this.imageDim.width>this.containerDim.width||this.imageDim.height>this.containerDim.height;return this.imageZoom=this.floorZoom+i*(this.ceilingZoom-this.floorZoom),s?(this.imageDim.width>this.imageDim.height?this.imageEl.style.width=this.imageZoom*this.containerDim.width+"px":this.imageEl.style.height=this.imageZoom*this.containerDim.height+"px",this.containerDim.ratio&&(this.imageDim.width>this.imageDim.height?this.imageEl.style.height=this.imageZoom*this.containerDim.width*this.containerDim.ratio+"px":this.imageEl.style.width=this.imageZoom*this.containerDim.height*this.containerDim.ratio+"px")):this.slider.setDisabled(),this.imageX=this.containerDim.width*(1-this.imageZoom)/2-t*this.imageZoom,this.imageY=this.containerDim.height*(1-this.imageZoom)/2-e*this.imageZoom,this.contain(this.imageX,this.imageY,this.draggable),!0},startZoomIn:function(){return this.slider.disabled||(this.zoomBtnPressed=!0,this.sliderAccel=.002,this.periodicalZoom(),this.zoomer=new PeriodicalExecuter(this.periodicalZoom.bind(this),.05)),this},startZoomOut:function(){return this.slider.disabled||(this.zoomBtnPressed=!0,this.sliderAccel=-.002,this.periodicalZoom(),this.zoomer=new PeriodicalExecuter(this.periodicalZoom.bind(this),.05)),this},stopZooming:function(){this.zoomer&&0!=this.sliderSpeed&&(this.zoomBtnPressed=!1,this.sliderAccel=0)},periodicalZoom:function(){return this.zoomer?(this.zoomBtnPressed?this.sliderSpeed+=this.sliderAccel:(this.sliderSpeed/=1.5,Math.abs(this.sliderSpeed)<.001&&(this.sliderSpeed=0,this.zoomer.stop(),this.zoomer=null)),this.slider.value+=this.sliderSpeed,this.slider.setValue(this.slider.value),this.scale(this.slider.value),this):this},contain:function(i,t,e){var s=Element.getDimensions(e.element),o=this.containerDim.width-s.width,n=this.containerDim.height-s.height;return i=i>0?0:i,i=i<o?o:i,t=t>0?0:t,t=t<n?n:t,this.containerDim.width>s.width&&(i=this.containerDim.width/2-s.width/2),this.containerDim.height>s.height&&(t=this.containerDim.height/2-s.height/2),this.imageX=i,this.imageY=t,this.imageEl.style.left=this.imageX+"px",this.imageEl.style.top=this.imageY+"px",[i,t]}},Product.Config=Class.create(),Product.Config.prototype={initialize:function(i){this.config=i,this.taxConfig=this.config.taxConfig,this.settings=$$(".super-attribute-select"),this.state=new Hash,this.priceTemplate=new Template(this.config.template),this.prices=i.prices,this.settings.each(function(i){Event.observe(i,"change",this.configure.bind(this))}.bind(this)),this.settings.each(function(i){var t=i.id.replace(/[a-z]*/,"");t&&this.config.attributes[t]&&(i.config=this.config.attributes[t],i.attributeId=t,this.state[t]=!1)}.bind(this));for(var t=[],e=this.settings.length-1;e>=0;e--){var s=!!this.settings[e-1]&&this.settings[e-1],o=!!this.settings[e+1]&&this.settings[e+1];0==e?this.fillSelect(this.settings[e]):this.settings[e].disabled=!0,$(this.settings[e]).childSettings=t.clone(),$(this.settings[e]).prevSetting=s,$(this.settings[e]).nextSetting=o,t.push(this.settings[e])}i.defaultValues&&(this.values=i.defaultValues);var n=window.location.href.indexOf("#");if(-1!=n){var h=window.location.href.substr(n+1),r=h.toQueryParams();this.values||(this.values={});for(var e in r)this.values[e]=r[e]}this.configureForValues(),document.observe("dom:loaded",this.configureForValues.bind(this))},configureForValues:function(){this.values&&this.settings.each(function(i){var t=i.attributeId;i.value=void 0===this.values[t]?"":this.values[t],this.configureElement(i)}.bind(this))},configure:function(i){var t=Event.element(i);this.configureElement(t)},configureElement:function(i){this.reloadOptionLabels(i),i.value?(this.state[i.config.id]=i.value,i.nextSetting&&(i.nextSetting.disabled=!1,this.fillSelect(i.nextSetting),this.resetChildren(i.nextSetting))):this.resetChildren(i),this.reloadPrice()},reloadOptionLabels:function(i){var t;t=i.options[i.selectedIndex].config?parseFloat(i.options[i.selectedIndex].config.price):0;for(var e=0;e<i.options.length;e++)i.options[e].config&&(i.options[e].text=this.getOptionLabel(i.options[e].config,i.options[e].config.price-t))},resetChildren:function(i){if(i.childSettings)for(var t=0;t<i.childSettings.length;t++)i.childSettings[t].selectedIndex=0,i.childSettings[t].disabled=!0,i.config&&(this.state[i.config.id]=!1)},fillSelect:function(i){var t=i.id.replace(/[a-z]*/,""),e=this.getAttributeOptions(t);this.clearSelect(i),i.options[0]=new Option("",""),i.options[0].innerHTML=this.config.chooseText;var s=!1;if(i.prevSetting&&(s=i.prevSetting.options[i.prevSetting.selectedIndex]),e)for(var o=1,n=0;n<e.length;n++){var h=[];if(s)for(var r=0;r<e[n].products.length;r++)s.config.allowedProducts&&s.config.allowedProducts.indexOf(e[n].products[r])>-1&&h.push(e[n].products[r]);else h=e[n].products.clone();h.size()>0&&(e[n].allowedProducts=h,i.options[o]=new Option(this.getOptionLabel(e[n],e[n].price),e[n].id),i.options[o].config=e[n],o++)}},getOptionLabel:function(i,t){var t=parseFloat(t);if(this.taxConfig.includeTax)var e=t/(100+this.taxConfig.defaultTax)*this.taxConfig.defaultTax,s=t-e,o=s*(1+this.taxConfig.currentTax/100);else var e=t*(this.taxConfig.currentTax/100),s=t,o=s+e;t=this.taxConfig.showIncludeTax||this.taxConfig.showBothPrices?o:s;var n=i.label;return t&&(this.taxConfig.showBothPrices?n+=" "+this.formatPrice(s,!0)+" ("+this.formatPrice(t,!0)+" "+this.taxConfig.inclTaxTitle+")":n+=" "+this.formatPrice(t,!0)),n},formatPrice:function(i,t){var e="";i=parseFloat(i),t&&(i<0?(e+="-",i=-i):e+="+");var s=(Math.round(100*i)/100).toString();return this.prices&&this.prices[s]?e+=this.prices[s]:e+=this.priceTemplate.evaluate({price:i.toFixed(2)}),e},clearSelect:function(i){for(var t=i.options.length-1;t>=0;t--)i.remove(t)},getAttributeOptions:function(i){if(this.config.attributes[i])return this.config.attributes[i].options},reloadPrice:function(){for(var i=0,t=0,e=this.settings.length-1;e>=0;e--){var s=this.settings[e].options[this.settings[e].selectedIndex];s.config&&(i+=parseFloat(s.config.price),t+=parseFloat(s.config.oldPrice))}return optionsPrice.changePrice("config",{price:i,oldPrice:t}),optionsPrice.reload(),i},reloadOldPrice:function(){if($("old-price-"+this.config.productId)){for(var i=parseFloat(this.config.oldPrice),t=this.settings.length-1;t>=0;t--){var e=this.settings[t].options[this.settings[t].selectedIndex];if(e.config){var s=parseFloat(e.config.oldPrice);i+=isNaN(s)?0:s}}i<0&&(i=0),i=this.formatPrice(i),$("old-price-"+this.config.productId)&&($("old-price-"+this.config.productId).innerHTML=i)}}},Product.Super={},Product.Super.Configurable=Class.create(),Product.Super.Configurable.prototype={initialize:function(i,t,e,s,o){this.container=$(i),this.observeCss=t,this.updateUrl=e,this.updatePriceUrl=s,this.priceContainerId=o,this.registerObservers()},registerObservers:function(){return this.container.getElementsByClassName(this.observeCss).each(function(i){Event.observe(i,"change",this.update.bindAsEventListener(this))}.bind(this)),this},update:function(i){var t=this.container.getElementsByClassName(this.observeCss),e=Form.serializeElements(t,!0);new Ajax.Updater(this.container,this.updateUrl+"?ajax=1",{parameters:e,onComplete:this.registerObservers.bind(this)});var s=$(this.priceContainerId);s&&new Ajax.Updater(s,this.updatePriceUrl+"?ajax=1",{parameters:e})}};